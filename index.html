<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FishTiers | Stable</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800;900&display=swap');
        
        :root {
            --accent: #FF0000;
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Montserrat', sans-serif; background: #000;
            color: #fff; margin: 0; padding-bottom: 100px;
        }

        .header { padding: 15px; background: #0a0a0a; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
        .logo { font-weight: 900; font-size: 20px; }
        .logo span { color: var(--accent); }

        .container { max-width: 1000px; margin: auto; padding: 20px; }
        .section-title { font-size: 10px; color: #666; text-transform: uppercase; margin: 20px 0 10px; text-align: center; letter-spacing: 2px; }

        .sub-nav { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; margin-bottom: 15px; }
        .nav-btn { background: var(--glass); border: 1px solid var(--border); color: #fff; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-size: 10px; font-weight: 800; text-transform: uppercase; }
        .nav-btn.active { background: var(--accent); border-color: var(--accent); }

        .tier-row { background: var(--glass); border: 1px solid var(--border); border-radius: 12px; margin-bottom: 10px; display: flex; overflow: hidden; }
        .tier-label { width: 60px; background: rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; font-weight: 900; color: var(--accent); }
        .players-wrap { padding: 10px; display: flex; flex-wrap: wrap; gap: 8px; }
        .p-tag { background: rgba(255,255,255,0.05); padding: 6px 12px; border-radius: 6px; font-size: 13px; cursor: pointer; border: 1px solid var(--border); }

        .player-card { background: var(--glass); border: 1px solid var(--border); border-radius: 15px; padding: 15px; display: flex; align-items: center; gap: 15px; cursor: pointer; }
        .rank-num { font-size: 20px; font-weight: 900; opacity: 0.3; width: 40px; }
        .skin { width: 45px; height: 45px; border-radius: 8px; }

        .admin-panel { position: fixed; bottom: 0; left: 0; width: 100%; background: #0a0a0a; padding: 15px; display: flex; gap: 5px; flex-wrap: wrap; justify-content: center; border-top: 2px solid var(--accent); z-index: 999; }
        .adm-in { background: #111; border: 1px solid #333; color: #fff; padding: 5px; font-size: 11px; border-radius: 4px; }

        .hidden { display: none !important; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 10px; }
    </style>
</head>
<body>

<header class="header">
    <div class="logo">FISH<span>TIERS</span></div>
    <input type="text" id="search" class="adm-in" placeholder="Поиск..." oninput="render()">
</header>

<div class="container">
    <div class="section-title">Режим</div>
    <div class="sub-nav">
        <button class="nav-btn active" onclick="setMode('global', this)">Топ</button>
        <button class="nav-btn" onclick="setMode('sword', this)">Мечи</button>
        <button class="nav-btn" onclick="setMode('bow', this)">Луки</button>
    </div>

    <div class="section-title">Сервер</div>
    <div class="sub-nav">
        <button class="nav-btn active" onclick="setSrv('all', this)">Все</button>
        <button class="nav-btn" onclick="setSrv('ugame', this)">UGAME</button>
        <button class="nav-btn" onclick="setSrv('breadix', this)">BREADIX</button>
        <button class="nav-btn" onclick="setSrv('minenex', this)">MINENEX</button>
    </div>

    <div id="view" class="grid"></div>
</div>

<div id="admin" class="admin-panel hidden">
    <input type="text" id="a-name" class="adm-in" placeholder="Ник">
    <input type="text" id="a-tier" class="adm-in" placeholder="HT1" style="width:40px">
    <input type="number" id="a-rank" class="adm-in" placeholder="Ранг" style="width:40px">
    <select id="a-srv" class="adm-in">
        <option value="ugame">UGAME</option><option value="breadix">BREADIX</option><option value="minenex">MINENEX</option>
    </select>
    <select id="a-type" class="adm-in">
        <option value="sword">Меч</option><option value="bow">Лук</option>
    </select>
    <label style="font-size:10px"><input type="checkbox" id="a-glob"> Топ?</label>
    <button onclick="save()" class="nav-btn" style="background:green">OK</button>
    <button onclick="del()" class="nav-btn" style="background:maroon">DEL</button>
</div>

<div style="text-align:center; opacity:0.1; font-size:10px;" onclick="auth()">ADMIN</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCwcHXslvUZoFJ6qOd-7TGZXo2dQrWx6Kg",
        authDomain: "fishtiers-b8b0f.firebaseapp.com",
        databaseURL: "https://fishtiers-b8b0f-default-rtdb.firebaseio.com",
        projectId: "fishtiers-b8b0f",
        storageBucket: "fishtiers-b8b0f.firebasestorage.app",
        messagingSenderId: "887698034750",
        appId: "1:887698034750:web:953f8fb88f215c7104816f"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let players = [];
    let mode = 'global', srv = 'all';

    db.ref('players').on('value', s => {
        players = s.val() ? Object.values(s.val()) : [];
        render();
    });

    function render() {
        const out = document.getElementById('view');
        const q = document.getElementById('search').value.toLowerCase();
        out.innerHTML = '';

        let filtered = players.filter(p => {
            const mSrv = srv === 'all' || p.srv === srv;
            const mName = p.name.toLowerCase().includes(q);
            const mType = mode === 'global' ? p.isGlob : p.type === mode;
            return mSrv && mName && mType;
        });

        // Сортировка по рангу (1 выше 2)
        filtered.sort((a,b) => a.rank - b.rank);

        if(mode === 'global') {
            out.className = 'grid';
            filtered.forEach(p => {
                out.innerHTML += `<div class="player-card">
                    <div class="rank-num">#${p.rank}</div>
                    <img src="https://minotar.net/helm/${p.name}/45.png" class="skin">
                    <div><b>${p.name}</b><br><small>${p.srv.toUpperCase()} | ${p.tier}</small></div>
                </div>`;
            });
        } else {
            out.className = '';
            const tiers = ["HT1","HT2","HT3","MT1","MT2","LT1","LT2","LT3"];
            tiers.forEach(t => {
                const ps = filtered.filter(p => p.tier === t);
                if(ps.length) {
                    out.innerHTML += `<div class="tier-row">
                        <div class="tier-label">${t}</div>
                        <div class="players-wrap">
                            ${ps.map(p => `<div class="p-tag">${p.name}</div>`).join('')}
                        </div>
                    </div>`;
                }
            });
        }
    }

    function setMode(m, e) {
        mode = m;
        document.querySelectorAll('.sub-nav:nth-of-type(1) .nav-btn').forEach(b => b.classList.remove('active'));
        e.classList.add('active');
        render();
    }

    function setSrv(s, e) {
        srv = s;
        document.querySelectorAll('.sub-nav:nth-of-type(2) .nav-btn').forEach(b => b.classList.remove('active'));
        e.classList.add('active');
        render();
    }

    function save() {
        const n = document.getElementById('a-name').value;
        if(!n) return;
        db.ref('players/'+n).set({
            name: n,
            tier: document.getElementById('a-tier').value.toUpperCase(),
            rank: parseInt(document.getElementById('a-rank').value) || 99,
            srv: document.getElementById('a-srv').value,
            type: document.getElementById('a-type').value,
            isGlob: document.getElementById('a-glob').checked
        });
    }

    function del() {
        const n = document.getElementById('a-name').value;
        if(n) db.ref('players/'+n).remove();
    }

    function auth() { if(prompt("Pass") === "123") document.getElementById('admin').classList.remove('hidden'); }
</script>

</body>
</html>
-panel hidden">
        <input type="text" id="adm-name" class="admin-input" placeholder="Ник" style="width:100px">
        <input type="text" id="adm-tier" class="admin-input" style="width:50px" placeholder="HT1">
        <input type="number" id="adm-rank-dev" class="admin-input" style="width:50px" placeholder="Место">
        <input type="number" id="adm-rank-glob" class="admin-input" style="width:50px" placeholder="Топ">
        <select id="adm-dev" class="admin-input"><option value="pc">PC</option><option value="gp">GP</option><option value="pe">PE</option></select>
        <select id="adm-type" class="admin-input"><option value="sword">Меч</option><option value="bow">Лук</option></select>
        <select id="adm-srv" class="admin-input"><option value="ugame">UGAME</option><option value="breadix">BREADIX</option><option value="minenex">MINENEX</option></select>
        <input type="text" id="adm-bio" class="admin-input" placeholder="Био" style="width:100px">
        <label style="font-size: 9px; color:white; display:flex; align-items:center; gap:3px;"><input type="checkbox" id="adm-global"> GLOB</label>
        <button class="admin-btn" onclick="saveData()">СОХРАНИТЬ</button>
        <button class="admin-btn" style="background:#333" onclick="deleteData()">УДАЛИТЬ</button>
    </div>
    <div style="position:fixed; bottom:5px; right:10px; font-size:8px; opacity:0.1; cursor:pointer;" onclick="auth()">ADMIN</div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCwcHXslvUZoFJ6qOd-7TGZXo2dQrWx6Kg",
            authDomain: "fishtiers-b8b0f.firebaseapp.com",
            databaseURL: "https://fishtiers-b8b0f-default-rtdb.firebaseio.com",
            projectId: "fishtiers-b8b0f",
            storageBucket: "fishtiers-b8b0f.firebasestorage.app",
            messagingSenderId: "887698034750",
            appId: "1:887698034750:web:953f8fb88f215c7104816f"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let players = [];
        let curMode = 'global', curDevice = 'all', curServer = 'all';
        let audioCtx;

        function playSound() {
            try {
                if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                if (audioCtx.state === 'suspended') audioCtx.resume();
                const o = audioCtx.createOscillator(), g = audioCtx.createGain();
                o.type='sine'; o.frequency.setValueAtTime(600, audioCtx.currentTime);
                o.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.1);
                g.gain.setValueAtTime(0.05, audioCtx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+0.1);
            } catch(e) {}
        }

        window.addEventListener('click', (e) => {
            if(e.target.tagName==='INPUT' || e.target.tagName==='SELECT' || e.target.tagName==='TEXTAREA') return;
            playSound();
            for(let i=0; i<6; i++) {
                const p = document.createElement('div'); p.className = 'click-particle';
                p.style.left = e.clientX+'px'; p.style.top = e.clientY+'px';
                p.style.setProperty('--tx', (Math.random()-0.5)*100+'px');
                p.style.setProperty('--ty', (Math.random()-0.5)*100+'px');
                document.body.appendChild(p); setTimeout(()=>p.remove(), 600);
            }
        });

        function getTierStyle(t) {
            if(t === "HT1") return "gold";
            if(t === "HT2") return "silver";
            if(t === "HT3") return "bronze";
            return "normal";
        }

        db.ref('players').on('value', snap => {
            players = snap.val() ? Object.values(snap.val()) : [];
            renderAll();
        });

        function renderAll() {
            const area = document.getElementById('display-area');
            const search = document.getElementById('search').value.toLowerCase().trim();
            area.innerHTML = '';

            const filtered = players.filter(p => {
                const mSearch = search === '' || p.name.toLowerCase().includes(search);
                const mDevice = (curDevice === 'all' || p.device === curDevice);
                const mServer = (curServer === 'all' || p.server === curServer);
                const mType = (curMode === 'global') ? true : (curMode === 'bows' ? p.type === 'bow' : p.type === 'sword');
                const mGlobal = (curMode === 'global') ? p.isGlobal : true;
                return mSearch && mDevice && mServer && mType && mGlobal;
            });

            if (curMode === 'global') {
                const grid = document.createElement('div'); grid.className = 'global-grid';
                filtered.sort((a,b) => (curDevice === 'all' ? a.rankGlob - b.rankGlob : a.rankDev - b.rankDev));
                
                filtered.forEach(p => {
                    const r = (curDevice === 'all' ? p.rankGlob : p.rankDev);
                    const rankStr = (r >= 999) ? "-" : `#${r}`;
                    const style = getTierStyle(p.tier);
                    grid.innerHTML += `<div class="player-card card-${style}" onclick="openBio('${p.name}')"><div class="rank-num">${rankStr}</div><div class="skin-box"><img src="https://minotar.net/helm/${p.name}/60.png"></div><div><b>${p.name}</b><br><small>${p.server.toUpperCase()} | ${p.tier}</small></div></div>`;
                });
                area.appendChild(grid);
            } else {
                const tiers = curMode === 'tiers' ? ["HT1", "HT2", "HT3", "MT1", "MT2", "LT1", "LT2", "LT3"] : ["HT1", "HT2", "HT3", "HT4", "HT5", "MT1", "MT2", "MT3", "MT4", "MT5", "LT1", "LT2", "LT3", "LT4", "LT5"];
                
                tiers.forEach(t => {
                    const tierPlayers = filtered.filter(p => p.tier === t).sort((a,b) => a.rankDev - b.rankDev);
                    if(tierPlayers.length > 0) {
                        const style = getTierStyle(t);
                        area.innerHTML += `<div class="tier-row"><div class="tier-label t-${style}">${t}</div><div class="players-wrap">${tierPlayers.map(p => `<div class="p-tag tag-${style}" onclick="openBio('${p.name}')">${p.name}</div>`).join('')}</div></div>`;
                    }
                });
            }
        }

        function init() {
            const s = JSON.parse(localStorage.getItem('fCfg')) || { color: '#FF0000', blur: 100 };
            document.getElementById('u-color').value = s.color;
            document.getElementById('u-blur').value = s.blur;
            updateUI(false);
        }

        function updateUI(save = true) {
            const c = document.getElementById('u-color').value, b = document.getElementById('u-blur').value;
            document.documentElement.style.setProperty('--accent', c);
            document.documentElement.style.setProperty('--blur', b + 'px');
            document.getElementById('glow').style.background = `radial-gradient(circle at 20% 20%, ${c} 0%, transparent 40%), radial-gradient(circle at 80% 80%, ${c} 0%, transparent 40%)`;
            if(save) localStorage.setItem('fCfg', JSON.stringify({ color: c, blur: b }));
        }

        function setMainMode(m, el) { curMode = m; updateActive(el, '#main-modes'); renderAll(); }
        function setDevice(d, el) { curDevice = d; updateActive(el, '#device-modes'); renderAll(); }
        function setServer(s, el) { curServer = s; updateActive(el, '#srv-select'); renderAll(); }
        function updateActive(el, parentId) { document.querySelectorAll(parentId + ' .nav-btn').forEach(b => b.classList.remove('active')); el.classList.add('active'); }
        function toggleModal(id) { document.getElementById(id).classList.toggle('hidden'); }

        function openBio(n) {
            const p = players.find(x => x.name === n); if(!p) return;
            document.getElementById('b-name').innerText = p.name;
            document.getElementById('b-img').src = `https://minotar.net/helm/${p.name}/100.png`;
            document.getElementById('b-stats').innerHTML = `DEVICE: ${p.device.toUpperCase()} | SERVER: ${p.server.toUpperCase()}<br>TIER: ${p.tier} | RANK: ${p.rankDev>=999?'-':'#'+p.rankDev} (ALL: ${p.rankGlob>=999?'-':'#'+p.rankGlob})`;
            document.getElementById('b-bio-text').innerText = p.bio || "Биография игрока отсутствует.";
            toggleModal('bio-modal');
        }

        function saveData() {
            const n = document.getElementById('adm-name').value.trim();
            if(!n) return alert("Введите ник!");
            
            db.ref('players/' + n).set({
                name: n, 
                tier: document.getElementById('adm-tier').value.toUpperCase(),
                rankDev: parseInt(document.getElementById('adm-rank-dev').value) || 999,
                rankGlob: parseInt(document.getElementById('adm-rank-glob').value) || 999,
                device: document.getElementById('adm-dev').value,
                type: document.getElementById('adm-type').value,
                server: document.getElementById('adm-srv').value,
                isGlobal: document.getElementById('adm-global').checked,
                bio: document.getElementById('adm-bio').value
            }).then(() => {
                alert("Игрок добавлен/обновлен!");
                document.getElementById('adm-name').value = '';
            });
        }
        
        function deleteData() { 
            const n = document.getElementById('adm-name').value.trim(); 
            if(n && confirm("Точно удалить " + n + "?")) {
                db.ref('players/' + n).remove().then(() => {
                    alert("Удалено!");
                    document.getElementById('adm-name').value = '';
                });
            }
        }
        
        function auth() { if(btoa(prompt("Пароль:")) === "ZG9pcnN5MTIz" style="width:100%; margin-top:20px;" onclick="toggleModal('user-modal')">ГОТОВО</button>
        </div>
    </div>

    <div id="admin-panel" class="admin-panel hidden">
        <input type="text" id="adm-name" class="admin-input" placeholder="Ник" style="width:80px">
        <input type="text" id="adm-tier" class="admin-input" style="width:40px" placeholder="HT1">
        <input type="number" id="adm-rank-dev" class="admin-input" style="width:45px" placeholder="RD">
        <input type="number" id="adm-rank-glob" class="admin-input" style="width:45px" placeholder="RG">
        <select id="adm-dev" class="admin-input"><option value="pc">PC</option><option value="gp">GP</option><option value="pe">PE</option></select>
        <select id="adm-type" class="admin-input"><option value="sword">Меч</option><option value="bow">Лук</option></select>
        <select id="adm-srv" class="admin-input"><option value="ugame">UGAME</option><option value="breadix">BREADIX</option><option value="minenex">MINENEX</option></select>
        <input type="text" id="adm-bio" class="admin-input" placeholder="Био" style="width:80px">
        <label style="font-size: 8px; color:white;"><input type="checkbox" id="adm-global"> GLOB</label>
        <button class="admin-btn" onclick="saveData()">SAVE</button>
        <button class="admin-btn" style="background:#333" onclick="deleteData()">DEL</button>
    </div>
    <div style="position:fixed; bottom:5px; right:10px; font-size:8px; opacity:0.1; cursor:pointer;" onclick="auth()">ADMIN</div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCwcHXslvUZoFJ6qOd-7TGZXo2dQrWx6Kg",
            authDomain: "fishtiers-b8b0f.firebaseapp.com",
            databaseURL: "https://fishtiers-b8b0f-default-rtdb.firebaseio.com",
            projectId: "fishtiers-b8b0f",
            storageBucket: "fishtiers-b8b0f.firebasestorage.app",
            messagingSenderId: "887698034750",
            appId: "1:887698034750:web:953f8fb88f215c7104816f"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let players = [];
        let curMode = 'global', curDevice = 'all', curServer = 'all';

        // --- Эффекты ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound() {
            try {
                if (audioCtx.state === 'suspended') audioCtx.resume();
                const o = audioCtx.createOscillator(), g = audioCtx.createGain();
                o.type='sine'; o.frequency.setValueAtTime(600, audioCtx.currentTime);
                o.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.1);
                g.gain.setValueAtTime(0.05, audioCtx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+0.1);
            } catch(e){}
        }

        window.addEventListener('click', (e) => {
            if(e.target.tagName==='INPUT' || e.target.tagName==='SELECT') return;
            playSound();
            for(let i=0; i<6; i++) {
                const p = document.createElement('div'); p.className = 'click-particle';
                p.style.left = e.clientX+'px'; p.style.top = e.clientY+'px';
                p.style.setProperty('--tx', (Math.random()-0.5)*100+'px');
                p.style.setProperty('--ty', (Math.random()-0.5)*100+'px');
                document.body.appendChild(p); setTimeout(()=>p.remove(), 600);
            }
        });

        // --- Логика рендеринга ---
        function getTierStyle(t) {
            if(t === "HT1") return "gold";
            if(t === "HT2") return "silver";
            if(t === "HT3") return "bronze";
            return "normal";
        }

        db.ref('players').on('value', snap => {
            players = snap.val() ? Object.values(snap.val()) : [];
            renderAll();
        });

        function renderAll() {
            const area = document.getElementById('display-area'), search = document.getElementById('search').value.toLowerCase();
            area.innerHTML = '';

            const filtered = players.filter(p => {
                const mSearch = p.name.toLowerCase().includes(search);
                const mDevice = (curDevice === 'all' || p.device === curDevice);
                const mServer = (curServer === 'all' || p.server === curServer);
                const mType = (curMode === 'global') ? true : (curMode === 'bows' ? p.type === 'bow' : p.type === 'sword');
                const mGlobal = (curMode === 'global') ? p.isGlobal : true;
                return mSearch && mDevice && mServer && mType && mGlobal;
            });

            if (curMode === 'global') {
                const grid = document.createElement('div'); grid.className = 'global-grid';
                // СОРТИРОВКА: 1 выше 2, 2 выше 3 и т.д.
                filtered.sort((a,b) => (curDevice === 'all' ? a.rankGlob - b.rankGlob : a.rankDev - b.rankDev));
                
                filtered.forEach(p => {
                    const r = (curDevice === 'all' ? p.rankGlob : p.rankDev);
                    if(r <= 0) return;
                    const style = getTierStyle(p.tier);
                    grid.innerHTML += `<div class="player-card card-${style}" onclick="openBio('${p.name}')"><div class="rank-num">#${r}</div><div class="skin-box"><img src="https://minotar.net/helm/${p.name}/60.png"></div><div><b>${p.name}</b><br><small>${p.server.toUpperCase()} | ${p.tier}</small></div></div>`;
                });
                area.appendChild(grid);
            } else {
                const tiers = curMode === 'tiers' ? ["HT1", "HT2", "HT3", "MT1", "MT2", "LT1", "LT2", "LT3"] : ["HT1", "HT2", "HT3", "HT4", "HT5", "MT1", "MT2", "MT3", "MT4", "MT5", "LT1", "LT2", "LT3", "LT4", "LT5"];
                
                tiers.forEach(t => {
                    // СОРТИРОВКА ВНУТРИ ТИРА: по девайс рангу
                    const tierPlayers = filtered.filter(p => p.tier === t).sort((a,b) => a.rankDev - b.rankDev);
                    if(tierPlayers.length > 0) {
                        const style = getTierStyle(t);
                        area.innerHTML += `<div class="tier-row"><div class="tier-label t-${style}">${t}</div><div class="players-wrap">${tierPlayers.map(p => `<div class="p-tag tag-${style}" onclick="openBio('${p.name}')">${p.name}</div>`).join('')}</div></div>`;
                    }
                });
            }
        }

        // --- Вспомогательные функции ---
        function init() {
            const s = JSON.parse(localStorage.getItem('fCfg')) || { color: '#FF0000', blur: 100 };
            document.getElementById('u-color').value = s.color;
            document.getElementById('u-blur').value = s.blur;
            updateUI(false);
        }

        function updateUI(save = true) {
            const c = document.getElementById('u-color').value, b = document.getElementById('u-blur').value;
            document.documentElement.style.setProperty('--accent', c);
            document.documentElement.style.setProperty('--blur', b + 'px');
            document.getElementById('glow').style.background = `radial-gradient(circle at 20% 20%, ${c} 0%, transparent 40%), radial-gradient(circle at 80% 80%, ${c} 0%, transparent 40%)`;
            if(save) localStorage.setItem('fCfg', JSON.stringify({ color: c, blur: b }));
        }

        function setMainMode(m, el) { curMode = m; updateActive(el, '#main-modes'); renderAll(); }
        function setDevice(d, el) { curDevice = d; updateActive(el, '#device-modes'); renderAll(); }
        function setServer(s, el) { curServer = s; updateActive(el, '#srv-select'); renderAll(); }
        function updateActive(el, parentId) { document.querySelectorAll(parentId + ' .nav-btn').forEach(b => b.classList.remove('active')); el.classList.add('active'); }
        function toggleModal(id) { document.getElementById(id).classList.toggle('hidden'); }

        function openBio(n) {
            const p = players.find(x => x.name === n); if(!p) return;
            document.getElementById('b-name').innerText = p.name;
            document.getElementById('b-img').src = `https://minotar.net/helm/${p.name}/100.png`;
            document.getElementById('b-stats').innerHTML = `DEVICE: ${p.device.toUpperCase()} | SERVER: ${p.server.toUpperCase()}<br>TIER: ${p.tier} | RANK: #${p.rankDev} (ALL: #${p.rankGlob})`;
            document.getElementById('b-bio-text').innerText = p.bio || "Биография игрока отсутствует.";
            toggleModal('bio-modal');
        }

        function saveData() {
            const n = document.getElementById('adm-name').value.trim();
            if(!n) return;
            db.ref('players/' + n).set({
                name: n, tier: document.getElementById('adm-tier').value.toUpperCase(),
                rankDev: parseInt(document.getElementById('adm-rank-dev').value) || 0,
                rankGlob: parseInt(document.getElementById('adm-rank-glob').value) || 0,
                device: document.getElementById('adm-dev').value,
                type: document.getElementById('adm-type').value,
                server: document.getElementById('adm-srv').value,
                isGlobal: document.getElementById('adm-global').checked,
                bio: document.getElementById('adm-bio').value
            }).then(() => alert("Saved!"));
        }
        function deleteData() { const n = document.getElementById('adm-name').value; if(n && confirm("DEL?")) db.ref('players/' + n).remove(); }
        function auth() { if(btoa(prompt("Pass:")) === "ZG9pcnN5MTIz") document.getElementById('admin-panel').classList.remove('hidden'); }
        init();
    </script>
</body>
</html>
