<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FishTiers | Ultimate Edition</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&display=swap');
        :root {
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            --accent: #0077FF;
            --text: #ffffff;
            --text-dim: #888;
            --blur: 15px;
        }
        body {
            font-family: 'Montserrat', sans-serif; background: #08090b;
            color: var(--text); margin: 0; min-height: 100vh; overflow-x: hidden;
        }
        .bg-glow {
            position: fixed; width: 100vw; height: 100vh; z-index: -1;
            background: radial-gradient(circle at 15% 15%, rgba(0, 119, 255, 0.1) 0%, transparent 40%),
                        radial-gradient(circle at 85% 85%, rgba(0, 119, 255, 0.1) 0%, transparent 40%);
            transition: 0.8s;
        }
        .header { background: rgba(0, 0, 0, 0.3); backdrop-filter: blur(20px); padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--glass-border); position: sticky; top: 0; z-index: 100; }
        .logo { font-weight: 900; font-size: 24px; text-transform: uppercase; letter-spacing: 2px; }
        .logo span { color: var(--accent); }
        .header-tools { display: flex; align-items: center; gap: 15px; }
        .search-box { background: var(--glass); border: 1px solid var(--glass-border); padding: 10px 20px; border-radius: 30px; color: white; outline: none; width: 140px; transition: 0.3s; }
        .search-box:focus { width: 200px; border-color: var(--accent); }
        .tool-btn { background: var(--glass); border: 1px solid var(--glass-border); color: white; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        .tool-btn:hover { background: var(--accent); transform: rotate(45deg); }

        .container { max-width: 1200px; margin: 20px auto; padding: 0 20px; padding-bottom: 150px; }
        .main-nav { display: flex; justify-content: center; gap: 10px; margin-bottom: 30px; }
        .nav-btn { background: var(--glass); border: 1px solid var(--glass-border); padding: 12px 25px; border-radius: 12px; cursor: pointer; font-weight: 800; color: var(--text-dim); text-transform: uppercase; transition: 0.3s; font-size: 11px; }
        .nav-btn.active { background: var(--accent); color: white; border-color: var(--accent); box-shadow: 0 0 20px rgba(0,119,255,0.2); }
        
        .global-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
        .player-card { background: var(--glass); backdrop-filter: blur(var(--blur)); border-radius: 18px; padding: 15px; display: flex; align-items: center; border: 1px solid var(--glass-border); transition: 0.3s; cursor: pointer; }
        .player-card:hover { border-color: var(--accent); transform: translateY(-3px); }
        .rank-num { font-weight: 900; font-size: 22px; width: 40px; opacity: 0.4; }
        .skin-box { width: 50px; height: 50px; background: #000; border-radius: 10px; margin-right: 15px; overflow: hidden; border: 1px solid var(--glass-border); }
        .skin-box img { width: 100%; image-rendering: pixelated; }

        .tier-row { background: var(--glass); backdrop-filter: blur(var(--blur)); border-radius: 15px; margin-bottom: 10px; border: 1px solid var(--glass-border); display: flex; overflow: hidden; }
        .tier-label { width: 60px; display: flex; align-items: center; justify-content: center; font-weight: 900; background: rgba(0,0,0,0.2); color: var(--accent); }
        .players-wrap { padding: 10px; display: flex; flex-wrap: wrap; gap: 8px; }
        .p-tag { background: rgba(255,255,255,0.05); padding: 5px 12px; border-radius: 6px; font-size: 13px; cursor: pointer; border: 1px solid transparent; transition: 0.2s; }
        .p-tag:hover { border-color: var(--accent); background: rgba(0,119,255,0.1); }

        .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(15px); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: #13141a; border: 1px solid var(--glass-border); width: 90%; max-width: 400px; border-radius: 20px; padding: 25px; }
        .setting-item { margin-bottom: 15px; }
        .setting-item label { display: block; font-size: 10px; color: var(--text-dim); text-transform: uppercase; margin-bottom: 5px; font-weight: 700; }

        .admin-panel { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 800px; background: rgba(10,10,12,0.95); backdrop-filter: blur(20px); border: 1px solid var(--accent); padding: 12px; display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; z-index: 999; border-radius: 12px; }
        .admin-input { background: #000; border: 1px solid #333; color: white; padding: 8px; border-radius: 6px; font-size: 12px; }
        .admin-btn { background: var(--accent); color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        
        .hidden { display: none !important; }
        body.compact .player-card { padding: 10px; }
        body.compact .skin-box { width: 35px; height: 35px; }
    </style>
</head>
<body id="b-root">
    <div class="bg-glow" id="glow"></div>
    
    <header class="header">
        <div class="logo">FISH<span>TIERS</span></div>
        <div class="header-tools">
            <input type="text" class="search-box" id="search" placeholder="–ü–æ–∏—Å–∫..." oninput="renderAll()">
            <button class="tool-btn" onclick="toggleModal('user-modal')">üé®</button>
        </div>
    </header>

    <div class="container">
        <div class="main-nav">
            <div id="nav-global" class="nav-btn active" onclick="switchMainMode('global')">–ì–ª–æ–±–∞–ª—å–Ω—ã–π –¢–æ–ø</div>
            <div id="nav-filter" class="nav-btn" onclick="switchMainMode('filter')">–°–µ—Ä–≤–µ—Ä—ã</div>
        </div>

        <div id="filter-controls" class="hidden" style="display:flex; justify-content:center; gap:8px; margin-bottom:20px;">
            <button class="nav-btn active" style="padding:8px 15px" onclick="setServer('ugame', this)">UGAME</button>
            <button class="nav-btn" style="padding:8px 15px" onclick="setServer('breadix', this)">BREADIX</button>
            <button class="nav-btn" style="padding:8px 15px" onclick="setServer('minenex', this)">MINENEX</button>
        </div>

        <div id="tiers-display" class="hidden"></div>
        <div id="global-display" class="global-grid"></div>
    </div>

    <div id="user-modal" class="modal-overlay hidden" onclick="toggleModal('user-modal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3 style="margin:0 0 20px 0">üé® –í–ò–ó–£–ê–õ</h3>
            <div class="setting-item">
                <label>–¶–≤–µ—Ç —Ç–µ–º—ã</label>
                <input type="color" id="set-accent" onchange="savePrefs()" style="width:100%; height:40px; border:none; background:none; cursor:pointer;">
            </div>
            <div class="setting-item">
                <label>–†–∞–∑–º—ã—Ç–∏–µ (Blur)</label>
                <input type="range" id="set-blur" min="0" max="30" oninput="savePrefs()" style="width:100%;">
            </div>
            <div class="setting-item" style="display:flex; justify-content:space-between; align-items:center;">
                <label>–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–∏–¥</label>
                <input type="checkbox" id="set-compact" onchange="savePrefs()" style="width:18px; height:18px;">
            </div>
            <button class="admin-btn" style="width:100%; margin-top:10px" onclick="toggleModal('user-modal')">–ó–ê–ö–†–´–¢–¨</button>
        </div>
    </div>

    <div id="bio-modal" class="modal-overlay hidden" onclick="toggleModal('bio-modal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div style="display:flex; align-items:center; gap:15px">
                <img id="m-img" src="" style="width:60px; height:60px; border-radius:10px">
                <h2 id="m-name" style="margin:0"></h2>
            </div>
            <p id="m-bio" style="background:rgba(255,255,255,0.03); padding:15px; border-radius:12px; margin-top:20px; font-size:14px; color:#ccc;"></p>
            <button class="admin-btn" style="width:100%" onclick="toggleModal('bio-modal')">–ó–ê–ö–†–´–¢–¨</button>
        </div>
    </div>

    <div id="admin-panel" class="admin-panel hidden">
        <input type="text" id="a-name" class="admin-input" placeholder="–ù–∏–∫">
        <input type="text" id="a-tier" class="admin-input" style="width:50px" placeholder="HT1">
        <input type="number" id="a-rank" class="admin-input" style="width:50px" placeholder="‚Ññ">
        <select id="a-srv" class="admin-input">
            <option value="ugame">UGAME</option><option value="breadix">BREADIX</option><option value="minenex">MINENEX</option>
        </select>
        <button class="admin-btn" onclick="saveToDB()">OK</button>
        <button class="admin-btn" style="background:#ff4747" onclick="deleteFromDB()">DEL</button>
    </div>
    <div style="position:fixed; bottom:5px; right:10px; font-size:9px; opacity:0.1; cursor:pointer; color:#fff;" onclick="auth()">Admin</div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCwcHXslvUZoFJ6qOd-7TGZXo2dQrWx6Kg",
            authDomain: "fishtiers-b8b0f.firebaseapp.com",
            databaseURL: "https://fishtiers-b8b0f-default-rtdb.firebaseio.com",
            projectId: "fishtiers-b8b0f",
            storageBucket: "fishtiers-b8b0f.firebasestorage.app",
            messagingSenderId: "887698034750",
            appId: "1:887698034750:web:953f8fb88f215c7104816f"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        let players = [];
        let mainMode = 'global';
        let currentServer = 'ugame';
        const SECRET_HASH = "ZG9pcnN5MTIz"; 

        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function loadPrefs() {
            const p = JSON.parse(localStorage.getItem('fPrefs')) || {acc: '#0077FF', blr: 15, cmp: false};
            document.getElementById('set-accent').value = p.acc;
            document.getElementById('set-blur').value = p.blr;
            document.getElementById('set-compact').checked = p.cmp;
            applyPrefs(p);
        }

        function savePrefs() {
            const p = {
                acc: document.getElementById('set-accent').value,
                blr: document.getElementById('set-blur').value,
                cmp: document.getElementById('set-compact').checked
            };
            localStorage.setItem('fPrefs', JSON.stringify(p));
            applyPrefs(p);
        }

        function applyPrefs(p) {
            document.documentElement.style.setProperty('--accent', p.acc);
            document.documentElement.style.setProperty('--blur', p.blr + 'px');
            document.getElementById('b-root').classList.toggle('compact', p.cmp);
            document.getElementById('glow').style.background = `radial-gradient(circle at 15% 15%, ${p.acc}15 0%, transparent 40%), radial-gradient(circle at 85% 85%, ${p.acc}15 0%, transparent 40%)`;
        }

        db.ref('players').on('value', snap => {
            players = snap.val() ? Object.values(snap.val()) : [];
            renderAll();
        });

        function switchMainMode(m) {
            mainMode = m;
            document.getElementById('nav-global').classList.toggle('active', m === 'global');
            document.getElementById('nav-filter').classList.toggle('active', m === 'filter');
            document.getElementById('filter-controls').classList.toggle('hidden', m === 'global');
            renderAll();
        }

        function setServer(s, el) {
            currentServer = s;
            document.querySelectorAll('#filter-controls .nav-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            renderAll();
        }

        function renderAll() {
            const g = document.getElementById('global-display');
            const t = document.getElementById('tiers-display');
            const s = document.getElementById('search').value.toLowerCase();

            if(mainMode === 'global') {
                t.classList.add('hidden'); g.classList.remove('hidden'); g.innerHTML = '';
                players.filter(p => p.rank > 0 && p.name.toLowerCase().includes(s))
                    .sort((a,b) => a.rank - b.rank)
                    .forEach(p => {
                        g.innerHTML += `<div class="player-card" onclick="openBio('${p.name}')"><div class="rank-num">#${p.rank}</div><div class="skin-box"><img src="https://minotar.net/helm/${p.name}/60.png"></div><div><b>${p.name}</b><br><small>${p.server} | ${p.tier}</small></div></div>`;
                    });
            } else {
                g.classList.add('hidden'); t.classList.remove('hidden'); t.innerHTML = '';
                ["HT1", "HT2", "HT3", "MT1", "MT2", "LT1", "LT2", "LT3"].forEach(tr => {
                    const filtered = players.filter(p => p.server === currentServer && p.tier === tr && p.name.toLowerCase().includes(s));
                    if(filtered.length > 0) {
                        t.innerHTML += `<div class="tier-row"><div class="tier-label">${tr}</div><div class="players-wrap">${filtered.map(p => `<div class="p-tag" onclick="openBio('${p.name}')">${p.name}</div>`).join('')}</div></div>`;
                    }
                });
            }
        }

        function saveToDB() {
            const n = document.getElementById('a-name').value;
            const tr = document.getElementById('a-tier').value;
            const r = parseInt(document.getElementById('a-rank').value) || 0;
            const s = document.getElementById('a-srv').value;
            if(n && tr) db.ref('players/' + n).set({name: n, tier: tr, rank: r, server: s, bio: ""});
        }

        function deleteFromDB() {
            const n = document.getElementById('a-name').value;
            if(n && confirm("–£–¥–∞–ª–∏—Ç—å?")) db.ref('players/' + n).remove();
        }

        function openBio(n) {
            const p = players.find(x => x.name === n);
            document.getElementById('m-name').innerText = p.name;
            document.getElementById('m-bio').innerText = p.bio || "–ë–∏–æ–≥—Ä–∞—Ñ–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞.";
            document.getElementById('m-img').src = `https://minotar.net/helm/${p.name}/100.png`;
            toggleModal('bio-modal');
        }

        function toggleModal(id) { document.getElementById(id).classList.toggle('hidden'); }
        function auth() { if(btoa(prompt("Pass:")) === SECRET_HASH) document.getElementById('admin-panel').classList.remove('hidden'); }
        
        window.onload = loadPrefs;
    </script>
</body>
</html>
