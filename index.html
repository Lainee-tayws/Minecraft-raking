<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FishTiers | User Custom Cloud</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&display=swap');
        :root {
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            --accent: #0077FF;
            --text: #ffffff;
            --text-dim: #888;
            --blur: 15px;
        }
        body {
            font-family: 'Montserrat', sans-serif; background: #08090b;
            color: var(--text); margin: 0; min-height: 100vh; overflow-x: hidden;
        }
        .bg-glow {
            position: fixed; width: 100vw; height: 100vh; z-index: -1;
            background: radial-gradient(circle at 15% 15%, rgba(0, 119, 255, 0.1) 0%, transparent 40%),
                        radial-gradient(circle at 85% 85%, rgba(0, 119, 255, 0.1) 0%, transparent 40%);
            transition: 0.5s;
        }
        .header { background: rgba(0, 0, 0, 0.3); backdrop-filter: blur(20px); padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--glass-border); position: sticky; top: 0; z-index: 100; }
        .logo { font-weight: 900; font-size: 24px; text-transform: uppercase; letter-spacing: 2px; }
        .logo span { color: var(--accent); }
        
        .header-tools { display: flex; align-items: center; gap: 15px; }
        .search-box { background: var(--glass); border: 1px solid var(--glass-border); padding: 10px 20px; border-radius: 30px; color: white; outline: none; width: 150px; transition: 0.3s; }
        .search-box:focus { width: 220px; border-color: var(--accent); }
        .user-opt-btn { background: var(--glass); border: 1px solid var(--glass-border); color: white; padding: 10px; border-radius: 50%; cursor: pointer; transition: 0.3s; font-size: 16px; display: flex; align-items: center; justify-content: center; }
        .user-opt-btn:hover { background: var(--accent); transform: rotate(45deg); }

        .container { max-width: 1200px; margin: 20px auto; padding: 0 20px; padding-bottom: 150px; }
        .main-nav { display: flex; justify-content: center; gap: 15px; margin-bottom: 40px; }
        .nav-btn { background: var(--glass); border: 1px solid var(--glass-border); padding: 15px 30px; border-radius: 15px; cursor: pointer; font-weight: 800; color: var(--text-dim); text-transform: uppercase; transition: 0.3s; font-size: 12px; }
        .nav-btn.active { background: var(--accent); color: white; border-color: var(--accent); box-shadow: 0 0 30px rgba(0,119,255,0.2); }
        
        .player-card { background: var(--glass); backdrop-filter: blur(var(--blur)); border-radius: 18px; padding: 15px; display: flex; align-items: center; border: 1px solid var(--glass-border); transition: 0.3s; cursor: pointer; }
        .player-card:hover { border-color: var(--accent); transform: translateY(-3px); }
        
        /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º */
        body.compact-mode .player-card { padding: 8px 12px; }
        body.compact-mode .skin-box { width: 40px; height: 40px; }
        body.compact-mode .rank-num { font-size: 18px; width: 35px; }

        .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(15px); display: flex; justify-content: center; align-items: center; z-index: 1000; transition: 0.3s; }
        .modal-content { background: rgba(20,20,25,0.9); border: 1px solid var(--glass-border); width: 90%; max-width: 400px; border-radius: 25px; padding: 30px; }
        .setting-row { margin-bottom: 20px; }
        .setting-row label { display: block; font-size: 11px; color: var(--text-dim); text-transform: uppercase; margin-bottom: 8px; font-weight: 700; }
        
        .admin-panel { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); width: 95%; max-width: 950px; background: rgba(10,10,12,0.95); backdrop-filter: blur(20px); border: 1px solid var(--accent); padding: 15px; display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; z-index: 999; border-radius: 15px; }
        .admin-input { background: #000; border: 1px solid #333; color: white; padding: 8px; border-radius: 8px; font-size: 12px; outline: none; }
        .admin-btn { background: var(--accent); color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .hidden { display: none !important; }
    </style>
</head>
<body id="main-body">
    <div class="bg-glow" id="glow"></div>
    
    <header class="header">
        <div class="logo">FISH<span>TIERS</span></div>
        <div class="header-tools">
            <input type="text" class="search-box" id="search" placeholder="–ü–æ–∏—Å–∫..." oninput="renderAll()">
            <button class="user-opt-btn" onclick="openUserModal()">üé®</button>
        </div>
    </header>

    <div class="container">
        <div class="main-nav">
            <div id="nav-global" class="nav-btn active" onclick="switchMainMode('global')">üèÜ –ì–ª–æ–±–∞–ª—å–Ω—ã–π</div>
            <div id="nav-filter" class="nav-btn" onclick="switchMainMode('filter')">üìÇ –°–µ—Ä–≤–µ—Ä—ã</div>
        </div>
        <div id="filter-controls" class="hidden">
            <div id="server-group" style="display:flex; justify-content:center; gap:10px;">
                <div class="nav-btn active" onclick="setServer('ugame', this)">UGAME</div>
                <div class="nav-btn" onclick="setServer('breadix', this)">BREADIX</div>
            </div>
        </div>
        <div id="tiers-display" style="margin-top: 30px;"></div>
        <div id="global-display" class="global-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px;"></div>
    </div>

    <div id="user-modal" class="modal-overlay hidden" onclick="closeUserModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h2 style="margin-top:0; font-weight:900;">–í–ò–ó–£–ê–õ</h2>
            <div class="setting-row">
                <label>–¶–≤–µ—Ç —Ç–≤–æ–µ–π —Ç–µ–º—ã</label>
                <input type="color" id="u-accent" onchange="applyUserPrefs()" style="width:100%; height:40px; border:none; background:none; cursor:pointer;">
            </div>
            <div class="setting-row">
                <label>–†–∞–∑–º—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–µ–π</label>
                <input type="range" id="u-blur" min="0" max="30" oninput="applyUserPrefs()" style="width:100%;">
            </div>
            <div class="setting-row" style="display:flex; justify-content:space-between; align-items:center;">
                <label style="margin:0;">–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–∏–¥</label>
                <input type="checkbox" id="u-compact" onchange="applyUserPrefs()" style="width:20px; height:20px;">
            </div>
            <button onclick="closeUserModal()" class="admin-btn" style="width:100%; margin-top:10px;">–ü–†–ò–ú–ï–ù–ò–¢–¨</button>
        </div>
    </div>

    <div id="bio-modal" class="modal-overlay hidden" onclick="closeBio()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div id="modal-name" style="font-size:26px; font-weight:900;"></div>
            <div id="modal-bio" style="margin-top:20px; background:rgba(255,255,255,0.03); padding:15px; border-radius:12px; line-height:1.5;"></div>
        </div>
    </div>

    <div id="admin-panel" class="admin-panel hidden">
        <input type="text" id="adm-name" class="admin-input" placeholder="–ù–∏–∫">
        <input type="text" id="adm-tier" class="admin-input" style="width:60px" placeholder="HT1">
        <input type="number" id="adm-rank" class="admin-input" style="width:60px" placeholder="–¢–æ–ø#">
        <button class="admin-btn" onclick="addPlayer()">OK</button>
        <button class="admin-btn" style="background:#444" onclick="location.reload()">REFRESH</button>
    </div>
    <div style="position:fixed; bottom:5px; right:10px; font-size:9px; opacity:0.1; cursor:pointer;" onclick="adminAuth()">Admin</div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCwcHXslvUZoFJ6qOd-7TGZXo2dQrWx6Kg",
            authDomain: "fishtiers-b8b0f.firebaseapp.com",
            databaseURL: "https://fishtiers-b8b0f-default-rtdb.firebaseio.com",
            projectId: "fishtiers-b8b0f",
            storageBucket: "fishtiers-b8b0f.firebasestorage.app",
            messagingSenderId: "887698034750",
            appId: "1:887698034750:web:953f8fb88f215c7104816f",
            measurementId: "G-7WBG0SBK4X"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let players = [];
        let currentServer = 'ugame';
        let mainMode = 'global';

        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function loadUserPrefs() {
            const prefs = JSON.parse(localStorage.getItem('userSettings')) || { accent: '#0077FF', blur: 15, compact: false };
            document.getElementById('u-accent').value = prefs.accent;
            document.getElementById('u-blur').value = prefs.blur;
            document.getElementById('u-compact').checked = prefs.compact;
            applyUserPrefs(false);
        }

        function applyUserPrefs(save = true) {
            const accent = document.getElementById('u-accent').value;
            const blur = document.getElementById('u-blur').value;
            const compact = document.getElementById('u-compact').checked;

            document.documentElement.style.setProperty('--accent', accent);
            document.documentElement.style.setProperty('--blur', blur + 'px');
            document.getElementById('glow').style.background = `radial-gradient(circle at 15% 15%, ${accent}15 0%, transparent 40%), radial-gradient(circle at 85% 85%, ${accent}15 0%, transparent 40%)`;
            document.getElementById('main-body').classList.toggle('compact-mode', compact);

            if(save) localStorage.setItem('userSettings', JSON.stringify({ accent, blur, compact }));
        }

        db.ref('players').on('value', (snap) => {
            players = snap.val() ? Object.values(snap.val()) : [];
            renderAll();
        });

        function renderAll() {
            const tiersDisplay = document.getElementById('tiers-display');
            const globalDisplay = document.getElementById('global-display');
            const search = document.getElementById('search').value.toLowerCase();

            if (mainMode === 'filter') {
                globalDisplay.classList.add('hidden');
                tiersDisplay.classList.remove('hidden');
                tiersDisplay.innerHTML = '';
                ["HT1", "HT2", "HT3", "MT1", "MT2", "LT1", "LT2", "LT3"].forEach(t => {
                    const filtered = players.filter(p => p.server === currentServer && p.tier === t && p.name.toLowerCase().includes(search));
                    tiersDisplay.innerHTML += `<div class="tier-row"><div class="tier-label">${t}</div><div class="players-wrap">${filtered.map(p => `<div class="p-tag" onclick="showBio('${p.name}')">${p.name}</div>`).join('')}</div></div>`;
                });
            } else {
                tiersDisplay.classList.add('hidden');
                globalDisplay.classList.remove('hidden');
                globalDisplay.innerHTML = '';
                const sorted = players.filter(p => p.rank > 0 && p.name.toLowerCase().includes(search)).sort((a,b) => a.rank - b.rank);
                sorted.forEach(p => {
                    globalDisplay.innerHTML += `<div class="player-card ${p.rank === 1 ? 'rank-1' : ''}" onclick="showBio('${p.name}')"><div class="rank-num">#${p.rank}</div><div class="skin-box"><img src="https://minotar.net/helm/${p.name}/60.png"></div><div><b>${p.name}</b><br><small>${p.server.toUpperCase()} | ${p.tier}</small></div></div>`;
                });
            }
        }

        function addPlayer() {
            const name = document.getElementById('adm-name').value;
            const tier = document.getElementById('adm-tier').value;
            const rank = document.getElementById('adm-rank').value;
            if(name) db.ref('players/' + name).update({ name, tier, rank, server: currentServer });
        }

        function switchMainMode(m) { mainMode = m; document.getElementById('nav-global').classList.toggle('active', m === 'global'); document.getElementById('nav-filter').classList.toggle('active', m === 'filter'); document.getElementById('filter-controls').classList.toggle('hidden', m === 'global'); renderAll(); }
        function setServer(s, el) { currentServer = s; document.querySelectorAll('#server-group .nav-btn').forEach(b => b.classList.remove('active')); el.classList.add('active'); renderAll(); }
        function openUserModal() { document.getElementById('user-modal').classList.remove('hidden'); }
        function closeUserModal() { document.getElementById('user-modal').classList.add('hidden'); }
        function showBio(n) { const p = players.find(x => x.name === n); document.getElementById('modal-name').innerText = p.name; document.getElementById('modal-bio').innerText = p.bio || "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ—Ç"; document.getElementById('bio-modal').classList.remove('hidden'); }
        function closeBio() { document.getElementById('bio-modal').classList.add('hidden'); }
        function adminAuth() { if(btoa(prompt("Pass:")) === "ZG9pcnN5MTIz") document.getElementById('admin-panel').classList.remove('hidden'); }

        window.onload = loadUserPrefs;
    </script>
</body>
</html>
classList.add('active');
            renderAll();
        }

        function renderAll() {
            const tiersDisplay = document.getElementById('tiers-display');
            const globalDisplay = document.getElementById('global-display');
            const search = document.getElementById('search').value.toLowerCase();

            if (mainMode === 'filter') {
                globalDisplay.classList.add('hidden');
                tiersDisplay.classList.remove('hidden');
                tiersDisplay.innerHTML = '';
                ["HT1", "HT2", "HT3", "MT1", "MT2", "LT1", "LT2", "LT3"].forEach(t => {
                    const filtered = players.filter(p => p.server === currentServer && p.tier === t && p.name.toLowerCase().includes(search));
                    const row = document.createElement('div');
                    row.className = 'tier-row';
                    row.innerHTML = `<div class="tier-label">${t}</div><div class="players-wrap">${filtered.map(p => `<div class="p-tag" onclick="showBio('${p.name}')">${p.name}</div>`).join('') || ''}</div>`;
                    tiersDisplay.appendChild(row);
                });
            } else {
                tiersDisplay.classList.add('hidden');
                globalDisplay.classList.remove('hidden');
                globalDisplay.innerHTML = '';
                const sorted = players.filter(p => p.rank > 0 && p.name.toLowerCase().includes(search)).sort((a,b) => a.rank - b.rank);
                sorted.forEach(p => {
                    globalDisplay.innerHTML += `
                        <div class="player-card ${p.rank <= 3 ? 'rank-'+p.rank : ''}" onclick="showBio('${p.name}')">
                            <div class="rank-num">#${p.rank}</div>
                            <div class="skin-box"><img src="https://minotar.net/helm/${p.name}/60.png"></div>
                            <div><b>${p.name}</b><br><div class="tier-badge">${p.server.toUpperCase()} | ${p.tier}</div></div>
                        </div>`;
                });
            }
        }

        function addPlayer() {
            const name = document.getElementById('adm-name').value;
            const srv = document.getElementById('adm-srv').value;
            const tier = document.getElementById('adm-tier').value;
            const rank = parseInt(document.getElementById('adm-rank').value) || 0;
            const bio = document.getElementById('adm-bio').value;
            if(!name || !tier) return alert("–ù–∏–∫ –∏ –¢–∏—Ä –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã!");
            db.ref('players/' + name).set({ name, tier, rank, bio, server: srv });
        }

        function deletePlayer() {
            const name = document.getElementById('adm-name').value;
            if(name && confirm("–£–¥–∞–ª–∏—Ç—å –∏–≥—Ä–æ–∫–∞ " + name + "?")) db.ref('players/' + name).remove();
        }

        function showBio(name) {
            const p = players.find(x => x.name === name);
            if(!p) return;
            document.getElementById('modal-name').innerText = p.name;
            document.getElementById('modal-img').src = `https://minotar.net/helm/${p.name}/100.png`;
            document.getElementById('modal-rank').innerText = p.rank > 0 ? `–ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–∞–Ω–≥: #${p.rank}` : "–í–Ω–µ —Ç–æ–ø–∞";
            document.getElementById('modal-bio').innerText = p.bio || "–ë–∏–æ–≥—Ä–∞—Ñ–∏—è –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞.";
            const allSrv = players.filter(x => x.name === name);
            document.getElementById('modal-tiers').innerHTML = allSrv.map(s => `<div class="tier-badge">${s.server}: ${s.tier}</div>`).join('');
            document.getElementById('bio-modal').classList.remove('hidden');
        }

        function closeBio() { document.getElementById('bio-modal').classList.add('hidden'); }
        
        function adminAuth() { 
            const pass = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:");
            if (btoa(pass) === SECRET_HASH) {
                document.getElementById('admin-panel').classList.remove('hidden');
            } else {
                alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!");
            }
        }

        switchMainMode('global');
    </script>
</body>
</html>
